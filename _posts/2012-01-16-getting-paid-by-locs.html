---
layout: post
title: Getting paid by LOCs?
date: '2012-01-16T21:36:00.000-08:00'
author: ndp
tags:
- software development
- ruby
- agile
- git
- coding
modified_time: '2012-01-19T11:06:52.389-08:00'
---

<div class="p1">I don't get paid by the lines of code I write. But I've certainly joked about it: there's a rumor that Trevor, who writes way too many comments, gets paid by the line (including comments).&nbsp;Ãœber-programmer Dave things his manhood is measured by the size of his commits.&nbsp;On a recent project the codebase was so large that I joked that every commit should be rejected if it didn't reduce the line count of the project. Haha.</div><div class="p2"><br /></div><div class="p1">This brings me to the boy scout rule: always leave the code nicer than when you started. This can be a little hard to quantify with a number: <a href="http://blog.james-carr.org/2009/10/01/beware-code-coverage-metrics/">test coverage</a>, <a href="http://www.ibm.com/developerworks/java/library/j-cq03316/">cyclomatic complexity</a> and <a href="http://clarkware.com/software/JDepend.html">coupling</a> metrics are all often used. But with a bloated codebase, a simple line count reduction may suffice to improve the codebase, although is not the <a href="http://www.thoughtclusters.com/2011/04/refactoring-is-not-about-reducing-code/">main</a> <a href="http://www.refactoringredmine.com/refactoring-to-reduce-code/">goal</a>. In my casual joking about this with my teammates, they all liked it. But how?</div><div class="p2"><br /></div><div class="p2"><b>How to Count</b></div><div class="p2"><br /></div><div class="p1">If you use&nbsp;<span style="font-family: 'Courier New', Courier, monospace;">git log --stat</span>, you can see&nbsp;the number of lines associated with each commit (after all the details), such as:</div><div class="p2"><br /></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">331 files changed, 0 insertions(+), 25866 deletions(-)</span></div><div class="p2"><br /></div><div class="p1">It's pretty easy to write a script that parses this information out, and <a href="https://github.com/ndp/gitlc">that's what I've done in gitlc tool</a>. Beyond the obvious grep, I added support for some necessities:</div><div class="p1"></div><ul><li>"pairs" set up using the git-pair tool. Commits checked in by multiple people will be credited to all committers. This is necessary with any project where pairing is used.</li><li>"aliases", so that if the same person commits with different email addresses (or it changes throughout the lifecycle of the project), the commit counts can be aggregated. This optional feature can be used by providing an optional yaml file.</li><li>commits can be aggregated by person, month, or simply by commit</li></ul><br /><div class="p1">Usage is pretty simple. Just download it&nbsp;and point it at a local directory with a .git folder. Here's gitlc source itself and ask for a summary by person:</div><div class="p1"><br /></div><div class="p1"></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">$ ./gitlc.rb -r . -p</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">[["ndp", {:net=&gt;657, :adds=&gt;26579, :deletes=&gt;25922}]]</span></div><div class="p1"><br /></div><div class="p1">As you can see, I had a 25K of code, which I abandoned quickly (thanks node).&nbsp;For projects with more people, it's more interesting:</div><div class="p1"><br /></div><div class="p1"></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">./gitlc.rb -p -r ../ruby-build/</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">[["sam", {:net=&gt;499, :adds=&gt;639, :deletes=&gt;140}],</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">&nbsp;["jeremy", {:net=&gt;33, :adds=&gt;50, :deletes=&gt;17}],</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">&nbsp;["josh", {:net=&gt;21, :adds=&gt;41, :deletes=&gt;20}],</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">&nbsp;["jesse", {:net=&gt;16, :adds=&gt;21, :deletes=&gt;5}],</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">&nbsp;["guilleig", {:net=&gt;11, :adds=&gt;53, :deletes=&gt;42}],</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">&nbsp;["bensie", {:net=&gt;6, :adds=&gt;6, :deletes=&gt;0}],</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">&nbsp;["chris", {:net=&gt;6, :adds=&gt;29, :deletes=&gt;23}],</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">&nbsp;["sstephenson", {:net=&gt;5, :adds=&gt;5, :deletes=&gt;0}],</span></div><div class="p1"><span style="font-family: 'Courier New', Courier, monospace;">&nbsp;...</span></div><div><br /></div><div>The tool sorts people by their "net" contribution to the project. For ruby-build, there's a long-tail of people with 1 line changes omitted. &nbsp;Please <a href="https://github.com/ndp/gitlc">check out gitlc</a> and see what you learn about your project.</div><div><br /></div><div>I'd love to have contributes to this tool. Feel free to fork and contribute back. It's easy to imagine better visualizations and a tool that could be incorporated in a workflow.</div><div><br /></div><div><b>Practicalities</b></div><div><br /></div><div>When you've got these statistics, and people start to care about their line count number. People ask me&nbsp;what to do if you need to write new functionality?&nbsp;</div><div><br /></div><div>I recommend:</div><br /><br /><div class="p1"></div><ul><li>Look first to share code. In a relatively large codebase, most features should already be there, but perhaps in a slightly different form. Most codebases bloat because we aren't able to figure out the common patterns. We can blame this on a hazy product definition, but at some point it's our responsibility to organize and structure the code ourselves.</li><li>Look for dead code. What features and code are no longer used? &nbsp;Get code coverage tools running, which help you identify branches of code that you can remove. Use web analytics to discover pages that are seldom visited and advocate to cut them out.&nbsp;</li></ul><br /><div class="p1">Riffing on the last point, a corollary to this blog post is the one that says each story needs to be accompanied by an "unstory". If we add a link to this page, what link do you want to take away? If the user can now spend 20 minutes cropping their profile picture, what aren't they going to be doing? But that's left for another day...</div>