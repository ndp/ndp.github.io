---
layout: post
title: "Unit testing time"
date: 2007-11-01
comments: false
url: /2007/11/2007-11-01-unit-testing-time.html
tags:
 - unit testing
 - Date class
 - mock objects
 - java
---

<div class='post'>
We've all run across the problem of trying to unit test some code that is dependent on the current date. Such as:<br /><br /><code><br />   public String elapsedTime(Date d) {<br />      final Date now = new Date();<br />      final long ms = now.getTime() - d.getTime();<br />      return "" + ms / 1000 + " seconds ago";<br />  }<br /></code><br /><br />How do you test something like this? (or something more sophisticated and useful)<br /><br />I found the solution in a posting about mock objects. The trouble is that this code is depending on the Date class, and its behavior of getting the current time. Imagine a Clock interface:<br /><br /><code><br />  interface Clock {<br />      Date getNow();<br />  }<br /></code><br /><br />and then a rewritten elapsed time:<br /><br /><code><br />  public String elapsedTime(Date d, Clock clock) {<br />      final Date now = clock.getNow();<br />      final long ms = now.getTime() - d.getTime();<br />      return "" + ms / 1000 + " seconds ago";<br />  }<br /></code><br /><br />Obviously the Clock can be injected in other ways, but now we have a testable and extensible method.</div>
