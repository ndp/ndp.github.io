---
layout: post
title: "Page-by-page Rewrite Refactor"
date: 2010-05-27
comments: false
url: /2010/05/page-by-page-rewrite-refactor.html
---

<div class='post'>
<span class="Apple-style-span" style="font-family: inherit;">At work today, the question came up (again) about how to approach upgrading a legacy app. There were many great comments, falling in the range from writing UI testings and using incremental rewrites,&nbsp;all the way to talking the client out of it. (Talk them into a v2!) What's similar between them all is that they feel "big", and therefore risky.&nbsp;</span><div><br /></div><div><span class="Apple-style-span" style="font-family: inherit;">Here's one of my successful experiences doing a rewrite in an agile, incremental way. &nbsp;A few years ago I was hired on at <a href="http://greatschools.org/">GreatSchools</a>&nbsp;to rewrite a large, aging, popular Perl web site. The overall goal was to rewrite, but the correct strategy wasn't set. We ended up doing a page-by-page rewrite-- one URL at a time-- into Java.</span><div><br /></div><div>This a little different than what you would do in a non-web app. Usually you have to divide an application into modules and rewrite one at a time, finding the "seams", or create them if they don't exist.&nbsp;On these types of projects, finding those seams in a large, spaghetti codebase can feel impossible.&nbsp;Creating seams may mean layering on unit or integration tests to make sure you don't break things along the way.&nbsp;See&nbsp;<a href="http://www.amazon.com/Working-Effectively-Legacy-Michael-Feathers/dp/0131177052">Working Effectively with Legacy Code</a>,&nbsp;</div><div><br /></div><div>The web, though, is a unique beast. It&nbsp;<span class="Apple-style-span" style="color: #333333;">doesn't care if the form is presented with Ruby and processed with Java.&nbsp;The idea is you keep the legacy app going, and replace pieces-- one URL at a time.&nbsp;We went down this path because we had lots traffic driven by organic search, so we didn't want to change URLs anyway. It turned out to be pretty low-risk and was successful.&nbsp;</span></div><div><span class="Apple-style-span" style="color: #333333;"><br /></span></div><div><span class="Apple-style-span" style="color: #333333;"><b>Practicalities</b></span></div><div><span class="Apple-style-span" style="color: #333333;"><br /></span></div><div><div><span style="color: #333333;"><i></i></span><br /><span style="color: #333333;"><i><div><span style="font-style: normal;"><span class="Apple-style-span" style="font-family: inherit;">The workflow was simple:</span></span></div></i></span><div><ol><li><span class="Apple-style-span" style="color: #333333;">pick a page.</span></li><li><span class="Apple-style-span" style="color: #333333;">implement that in the new technology</span></li><li><span class="Apple-style-span" style="color: #333333;">deploy and&nbsp;tweak proxies to serve the new page instead of the old version</span></li><li><span class="Apple-style-span" style="color: #333333;">deal with any fallout</span></li><li><span class="Apple-style-span" style="color: #333333;">repeat</span></li></ol></div><span style="color: #333333; font-style: italic;"><div><span style="font-style: normal;"><span class="Apple-style-span" style="font-family: inherit;">Of course sometimes we did more than one page at a time, but you get the idea. &nbsp;Eventually we could just turn off the old app. &nbsp;</span></span></div><div><span class="Apple-style-span" style="font-style: normal;"><br /></span></div><div><span class="Apple-style-span" style="font-style: normal;"><b>Concerns</b></span></div><div><span class="Apple-style-span" style="font-style: normal;"><br /></span></div><div><span style="font-style: normal;"><span class="Apple-style-span" style="font-family: inherit;">My initial concern was that we were making it much more complicated system than necessary, but it wasn't as complicated as I suspected-- HTTP provides a clean interfaces on each page. Although it can be difficult to read Perl code that processes a page, we could see all the parameters that were expected (with help of our web analytics), and make sure we supported them.</span></span></div><div><span class="Apple-style-span" style="font-style: normal;"><br /></span></div><div><span class="Apple-style-span" style="font-style: normal;">This approach is different than other rewriting approaches in that we didn't write any tests against the legacy app-- no need. &nbsp;But we did write new code up to an acceptable quality standard, with solid test coverage.</span></div></span><div><span class="Apple-style-span" style="color: #333333;"><br /></span></div><div><span style="color: #333333;"><span class="Apple-style-span" style="font-family: inherit;">We did have a small amount of &nbsp;extra code we need to write to support running in parallel, sharing cookies, dbs, and eventually HTML partials. In the end, though, I'm not sure that much of this work was extraneous, as we needed to deal with users migrating between the systems anyway-- whether it was to make it transparent like we did, or needed communication about "version 2".</span></span></div><div><span style="color: #333333;"><span class="Apple-style-span" style="font-family: inherit;"><br /></span></span></div><div><span style="color: #333333;"><span class="Apple-style-span" style="font-family: inherit;">I'll admit the business logic wasn't that complicated-- but it was a large, high-traffic site.&nbsp;</span></span></div><div><span style="color: #333333;"><span class="Apple-style-span" style="font-family: inherit;"><br /></span></span></div><div><span style="color: #333333;"><span class="Apple-style-span" style="font-family: inherit;">The biggest risk is that you get 1/3 of the way in and abandon it-- then you have a bigger mess. But I'm not sure this is much worse than other approaches. It's nice if you like incremental delivery, as it will get your changes up the fastest of all the suggestions.&nbsp;</span></span></div><div><span class="Apple-style-span" style="color: #333333;"><br /></span></div><div><span class="Apple-style-span" style="color: #333333;"><b>Is It Right for Me?</b></span></div><div><span class="Apple-style-span" style="color: #333333;"><br /></span></div><div><span class="Apple-style-span" style="color: #333333;">When people at a company start talking about a "rewrite", the team-- not only the developers-- want to reconsider everything-- basically doing a whole new site. This case was no different, and when I arrived it<span class="Apple-style-span" style="color: black;">&nbsp;was framed as a "site redesign". So a page-by-page approach-- without a holistic view-- might seem like an odd approach. In the end, though, we didn't have the resources necessary&nbsp;such a project requires&nbsp;(think two teams). Like migrating code, it was easier to do incremental redesigns. Approaching the project page-by-page turned out to be ideal. As we re-implemented pages, we reconsidered them, and often significantly improved them. Although we re-implemented existing pages, we also introduced new pages when it made sense.</span></span></div><div><br /></div><div><span style="color: #333333; font-style: italic;"><div><span style="font-style: normal;"><span class="Apple-style-span" style="font-family: inherit;">The benefits of being able to proceed incrementally far outweighed that cost.&nbsp;</span></span></div><div><span style="font-style: normal;"><span class="Apple-style-span" style="font-family: inherit;"><br /></span></span></div></span></div></div></div></div></div>
